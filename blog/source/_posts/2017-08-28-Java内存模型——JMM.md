---
title: Java内存模型——JMM
date: 2017-08-28 21:19:15
tags: [java,record]
categories: 聚沙成塔
---

 <!--TOC-->

JMM 全称,Java Memory Model. 这个内存模型与Stack，heap GC分代的内存模型，不是一回事，两者是通过不通的维度，将硬件访问抽象出来的一层抽象的逻辑模型，JVM屏蔽了硬件的直接操作。 GC分代的内存模型更加贴近与垃圾回收和内存分配使用的理解，而JMM模型更加贴近，多线程和内存之间的通讯。

 <!--more-->
 
## 工作内存和主内存
 
Java内存模型规定了所有的变量都存储在主内存（Main Memory）中。每条线程还有自己的工作内存，线程的工作内存中保存了被该线程使用到的变量的主内存副本拷贝，线程对变量的所有操作（读取、赋值等）都必须在工作内存中进行，而不能直接读写主内存中的变量。不同的线程之间也无法直接访问对方工作内存中的变量，线程间变量值的传递均需要通过主内存来完成。 

**需要注意的是， 放在主内存的变量包括，实例字段、静态字段和构成数组对象的元素，但不包括局部变量与方法参数，因为后者是线程独有的。**

## 内存间的交互操作

线程间如果要完成变成的同步和共享，必须经历下面2个步骤。

   1. 线程A必须要把线程A的工作内存更新过的变量刷新到主内存去。

   2. 线程B到主内存中去读取线程A更新过的共享变量

这些通讯操作是被JMM屏蔽的，要保证变量的线程安全共享需要使用Java的同步块(synchonrized），或者其他并发工具。这里强调的是安全共享，在不加同步块，和并发工具的情况下，变量也是可以被共享的，只是不能保证读都最新数据，就是常说的脏读，错读等。