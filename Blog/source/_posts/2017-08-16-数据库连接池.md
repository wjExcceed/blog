---
title: 数据库连接池
date: 2017-08-16 10:46:45
tags: record
categories: 聚沙成塔
---

使用连接池可帮助您降低连接管理开销并减少数据访问的开发任务。
每当应用程序尝试访问后端存储器（例如数据库）时，它需要资源以创建、维护和释放与该数据库的连接。为了减轻此过程对整体应用程序资源的影响，应用程序服务器允许管理员在应用程序服务器上建立可以由应用程序共享的后端连接池。连接池在数个用户请求之间分布连接开销，从而节省了应用程序资源以供将来的请求使用。
应用程序服务器支持用于连接池和连接重用的 JDBC 4.0 API。使用连接池指导应用程序中 JDBC 调用，指导企业 bean 使用数据库。


## 使用连接池的好处
&emsp;&emsp;连接池可改进任何需要连接的应用程序（特别是基于 Web 的应用程序）的响应时间。当用户通过 Web 对资源发出请求时，该资源将访问数据源。由于用户频繁地与因特网上的应用程序建立连接和断开连接，所以应用程序的数据访问请求量可能会相当大。因此，对于基于 Web 的应用程序数据存储器总开销会迅速增大，性能随之下降。但是，使用连接池功能时，Web 应用程序的性能相对于正常结果可以提高达 20 倍。
&emsp;&emsp;借助连接池，大多数用户请求不会引起创建新连接的开销，因为数据源能找出并使用连接池中的现有连接。当请求得到满足，并将响应返回到用户时，该资源会将连接返回到连接池以供再次使用。这就避免了断开连接造成的开销。每个用户请求都有一些连接或断开连接的开销。使用初始资源在池中产生连接后，由于能重用现有连接，因此其他开销并不大。

## 何时使用连接池
在符合任何以下条件的应用程序中使用连接池：
1、它不能忍受每次使用连接时获取连接和释放连接的开销。
2、它需要应用程序服务器中的 Java 事务 API (JTA) 事务。
3、它需要在相同事务中的多个用户之间共享连接。
4、它需要利用产品功能部件来管理应用程序服务器中的局部事务。
5、它不管理其自己连接的池。
6、它不管理创建连接的细节（如数据库名称、用户名或密码）

## 数据库连接池的优点
1、资源重用
2、更快的系统响应速度
3、新的资源分配手段
4、统一的连接管理，避免数据库连接泄漏

## 常用的开源连接池

### DBCP数据源
DBCP 是 Apache 软件基金组织下的开源连接池实现，使用DBCP，需要如下两个 jar 文件（commons-dbcp-1.4.jar和commons-pool-1.5.6.jar）：
Tomcat 的连接池也是采用该连接池来实现的。
该数据库连接池既可以与应用服务器整合使用，也可由应用程序独立使用。

### C3P0
C3P0是一个开源的JDBC连接池，它实现了数据源和JNDI绑定，支持JDBC3规范和JDBC2的标准扩展。目前使用它的开源项目有Hibernate，Spring等。C3P0数据源在项目开发中使用得比较多。

**c3p0与dbcp区别**
1、dbcp没有自动回收空闲连接的功能
2、c3p0有自动回收空闲连接功能
需要导入jar：c3p0-0.9.5.1.jar和mchange-commons-java-0.2.10.jar
在类目录下加入C3P0的配置文件：c3p0-config.xml

### jdbcUtils
commons-dbutils 是 Apache 组织提供的一个开源 JDBC工具类库，它是对JDBC的简单封装，学习成本极低，并且使用dbutils能极大简化jdbc编码的工作量，同时也不会影响程序的性能。