---
title: 数据库的整理笔记
date: 2017-08-01 15:50:09
tags: record
categories: 聚沙成塔
---
<!-- TOC -->

## 索引

1. **聚集索引：**索引键值的逻辑顺序与索引所服务的表中相应行的物理顺序**相同**的索引。
2. **非聚集索引：**索引键值的逻辑顺序与索引所服务的表中相应行的物理顺序**不相同**的索引。
3. **唯一索引：**唯一索引是不允许其中任何两行具有相同索引值的索引。
4. **主键索引：**主键索引是唯一索引的特定类型。该索引要求主键中的每个值都唯一。当在查询中使用主键索引时，它还允许对数据的快速访问。

&emsp;&emsp;聚集索引的索引值是直接指向数据表对应元组的，而非聚集索引的索引值仍会指向下一个索引数据块，不直接指向元组，因为还有一层索引进行重定向，所以非聚集索引可以拥有不同的键值排序而拥有多个不同的索引。而聚集索引因为与表的元组物理顺序一一对应，所以只有一种排序，即一个数据表只有一个聚集索引。


## 建索引的几大原则
1. 最左端前缀匹配原则：mysql会一直向右匹配直到遇到**范围查询(>、<、between、like)**。
2. “=”和“in”可以乱序，比如a = 1 and b = 2 and c = 3建立(a,b,c)索引可以任意顺序，mysql的查询优化器会帮你优化成索引可以识别的形式。
3. 尽量选择区分度高的列作为索引，区分度=count(distinct col)/count(*)，表示字段不重复的比例，比例越大，扫描的记录数越少，唯一键的区分度为1。一般需要join的字段的要求是区分度在0.1以上，即平均1条扫描10条记录。
4. 索引列不能参与计算，需要保持列“干净”。例如from_unixtime(create_time) = '2017-08-04'需要改写为create_time = unix_timestamp('2017-08-04')。
5. 尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可。

## 应该创建索引的列
1. 在经常需要搜索的列上，可以加快搜索的速度；
2. 在经常需要排列的列上创建索引，因为索引已经排序，这样查询可以利用索引的排序，加快排序查询时间；
3. 在经常使用在WHERE子句的列上面创建索引，加快条件的判断速度；
4. 在作为主键的列上，强制该列的唯一性和组织表中数据的排列结构；
5. 在经常用在连接的列上，这些列主要是一些外键，可以加快连接的速度；
6. 在经常需要根据范围进行搜索的列上创建索引，因为索引已经排序，其指定的范围是连续的；

## 不应该创建索引的列
第一，对于那些在查询中使用很少或者作为参考的列不应该创建索引。
第二，对于那些只有很少数据值的列不应该增加索引。
第三，对于那些定义为text,image和bit数据类型的列不应该增加索引。因为这些列的数据量要么很大，要么很少。
第四，当修改性能远远大于检索性能时，不应该创建索引。

## 聚集索引

**定义：在聚集索引中，叶节点即数据节点，所有数据航的存储顺序与索引的存储顺序一致。**

当需要在根据此字段查找特定的记录时，数据库系统会根据特定的系统表查找的此索引的根，然后根据指针查找下一个，直到找到。例如我们要查询“Green”，由于它介于[Bennet,Karsen]，据此我们找到了索引页1007，在该页中“Green”介于[Greane, Hunter]间，据此我们找到叶结点1133（也即数据结点），并最终在此页中找以了目标数据行。

{% asset_img 聚集索引.JPG 聚集索引 %}

## 非聚集索引

聚集索引是一种稀疏索引，数据页上一级的索引页存储的是页指针，而不是行指针。
而对于非聚集索引，则是密集索引，在数据页的上一级索引页它为每一个数据行存储一条索引记录。

非聚集索引与聚集索引相比：
A）叶子结点并非数据结点
B）叶子结点为每一真正的数据行存储一个“键-指针”对
C）叶子结点中还存储了一个指针偏移量，根据页指针及指针偏移量可以定位到具体的数据行。
D）类似的，在除叶结点外的其它索引结点，存储的也是类似的内容，只不过它是指向下一级的索引页的。

{% asset_img 非聚集索引.JPG 非聚集索引 %}



## 参考文献

1. [维基百科：索引](https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95)
2. [MySQL索引原理及慢查询优化](https://tech.meituan.com/mysql-index.html)
3. [数据库进阶系列之一：漫谈数据库索引](http://www.cnblogs.com/morvenhuang/archive/2009/03/30/1425534.html)